// Stacking attack speed buff (Jax-style)
// Gain stacks on hit, bonus on crit, reset after inactivity
// Stacks increase AttackSpeed primitive
(
    on_hit: [
        // Gain stack and reset decay timer
        (effects: [
            Add(Custom("Stacks"), 1),
            Reset(Custom("StackDecay"), 2.5),
        ]),
        // Cap at max stacks
        (conditions: [Gt(Custom("Stacks"), 12)], effects: [Set(Custom("Stacks"), 12)]),
        // Update AttackSpeed: 1.0 + (Stacks * 0.12)
        (effects: [Assign(
            var: AttackSpeed,
            expr: Add(Lit(1.0), Mul(Var(Custom("Stacks")), Lit(0.12))),
        )]),
    ],
    on_crit_hit: [
        // Bonus stacks on crit
        (effects: [Add(Custom("Stacks"), 2)]),
        // Cap at max stacks
        (conditions: [Gt(Custom("Stacks"), 12)], effects: [Set(Custom("Stacks"), 12)]),
        // Update AttackSpeed
        (effects: [Assign(
            var: AttackSpeed,
            expr: Add(Lit(1.0), Mul(Var(Custom("Stacks")), Lit(0.12))),
        )]),
    ],
    on_tick: [
        // Decrement decay timer
        (conditions: [Active(Custom("StackDecay"))], effects: [Tick(Custom("StackDecay"))]),
        // Reset stacks and attack speed when expired
        (
            conditions: [Expired(Custom("StackDecay")), Gt(Custom("Stacks"), 0)],
            effects: [Set(Custom("Stacks"), 0), Set(AttackSpeed, 1.0)],
        ),
    ],
)
